# 什么是操作系统中断？

> 原文:[https://www.javatpoint.com/what-is-interrupt-in-os](https://www.javatpoint.com/what-is-interrupt-in-os)

中断是硬件或软件在进程或事件需要立即关注时发出的信号。它会提醒处理器某个高优先级进程需要中断当前工作进程。在输入输出设备中，其中一条总线控制线专用于此目的，称为 ***中断服务程序*** (ISR)。

当设备在进程中引发中断时，处理器首先完成指令的执行。然后加载带有 ISR 第一条指令地址的 ***程序计数器*** (PC)。在用地址加载程序计数器之前，被中断指令的地址被移到一个临时位置。因此，在处理中断后，处理器可以继续处理。

当处理器处理中断时，它必须通知设备其请求已被识别，以停止发送中断请求信号。此外，保存寄存器以便中断的进程在将来可以恢复会增加从收到中断到开始执行中断服务程序之间的延迟。这被称为 ***中断延迟*** 。

![What is Interrupt in OS](../Images/53ecb68f4b22ed49b15b6deb174eebf0.png)

一台计算机一次只能执行一条计算机指令。但是，因为它可以被中断，所以它可以管理如何执行程序或指令集。这就是所谓的 ***多任务*** 。它允许用户同时做许多不同的事情，计算机开始管理用户启动的程序。当然，计算机的运行速度让它看起来好像所有的用户任务都在同时执行。

操作系统通常有一些被称为 ***中断处理程序*** 的代码。如果有多个中断正在等待处理，中断处理程序会对中断进行优先级排序，并将它们保存在队列中。操作系统还有另一个小程序叫做 ***调度程序*** ，它计算出下一个要控制的程序。

### 中断的类型

中断信号可以响应硬件或软件事件而发出。这些分别归类为 ***硬件中断*** 或 ***软件中断*** 。

![What is Interrupt in OS](../Images/094594693075f6b3c9db6b3abc8b65c2.png)

### 1.硬件中断

硬件中断是一种与硬件状态相关的情况，可以由外部硬件设备发出信号，例如电脑上的中断请求(IRQ)线路，或者由嵌入处理器逻辑中的设备检测到，以传达设备需要操作系统的注意。例如，按下键盘键或移动鼠标会触发硬件中断，导致处理器读取击键或鼠标位置。

硬件中断可以在处理器时钟和指令执行期间的任何时间异步到达。因此，所有硬件中断信号都通过与处理器时钟同步来调节，并且只在指令执行边界起作用。

在许多系统中，每个设备都与一个特定的 IRQ 信号相关联。这使得可以快速确定哪个硬件设备正在请求服务，并加快该设备的服务。

在一些较旧的系统上，所有中断都去往同一个位置，并且操作系统使用专门的指令来确定最高优先级的未屏蔽中断。在现代系统中，每种类型的中断或每个中断源通常都有一个不同的中断例程，通常实现为一个或多个中断向量表。硬件中断进一步分为两种类型，例如:

*   **可屏蔽中断:**处理器通常有一个内部中断屏蔽寄存器，允许选择性启用和禁用硬件中断。每个中断信号与屏蔽寄存器中的一个位相关联；在某些系统中，该位置 1 时使能中断，该位清零时禁用中断，而在其他系统中，置 1 时禁用中断。当中断被禁用时，相关的中断信号将被处理器忽略。受屏蔽影响的信号称为 ***可屏蔽中断*** 。
    中断屏蔽不影响某些中断信号，因此不能禁用；这些被称为 ***不可屏蔽中断*** (NMI)。nmi 表示需要立即处理的高优先级事件，在任何情况下都不能忽略，例如来自看门狗定时器的超时信号。
    对 ***屏蔽*** 中断是将其禁用，而对 ***取消屏蔽*** 中断是将其启用。
*   **虚假中断:**
    虚假中断是一种找不到来源的硬件中断。术语幻影中断或幽灵中断也可以用来描述这种现象。伪中断往往是连接到电平敏感处理器输入的有线或中断电路的问题。当系统行为不当时，这种中断可能很难识别。
    在有线或电路中，通过中断线路的偏置电阻进行充电/放电的寄生电容会在处理器意识到中断源已被清除之前造成一个小延迟。如果中断设备在中断服务程序(ISR)中清除得太晚，在中断服务程序的当前实例终止之前，中断电路将没有足够的时间返回静态。结果是，处理器会认为另一个中断正在等待，因为其中断请求输入端的电压不会高或低到足以建立明确的内部逻辑 1 或逻辑 0。明显的中断将没有可识别的来源，因此这被称为杂散。
    如果 ISR 没有考虑到这种中断发生的可能性，虚假中断可能会导致系统死锁或其他未定义的操作。由于伪中断大多是有线或中断电路的问题，在这种系统中，良好的编程实践是由中断服务人员检查所有中断源的活动，如果没有中断源，则不采取任何措施。

### 2.软件中断

处理器在执行特定指令或满足特定条件时请求软件中断。每个软件中断信号都与特定的中断处理程序相关联。

软件中断可能是由执行特殊指令故意引起的，该指令在被设计执行时调用中断。这些指令的功能类似于子例程调用，用于各种目的，例如请求操作系统服务和与设备驱动程序交互。

软件中断也可能由程序执行错误意外触发。这些中断通常被称为 ***陷阱*** 或 ***异常*** 。

### 处理多个设备

当多个设备发出中断请求信号时，需要额外的信息来决定首先考虑哪个设备。以下方法用于决定首先选择哪个设备，

![What is Interrupt in OS](../Images/ef037d45fa946b873020e00df2f6d1a5.png)

1.  **轮询**
    在轮询中，首先服务遇到的第一个设置了 IRQ 位的设备，并调用适当的 ISR 来服务该设备。这很容易实现，但是询问所有设备的 IRQ 位会浪费很多时间。
2.  **矢量中断**
    在矢量中断中，请求中断的设备通过总线向处理器发送特殊代码来直接识别自己。这使处理器能够识别产生中断的设备。特殊代码可以是 ISR 的起始地址或 ISR 在内存中的位置，称为 ***中断向量*** 。
3.  **中断嵌套**
    在这种方法中，输入/输出设备以优先级结构组织。因此，来自较高优先级设备的中断请求会被识别，而较低优先级设备则不会。处理器只接受优先级高于它的设备/进程的中断。
    处理器优先级编码在进程状态寄存器的几个位中，可以通过写入进程状态寄存器的程序指令进行更改。处理器仅在执行操作系统例程时处于监督模式，并且在执行应用程序之前切换到用户模式。

### 中断处理

我们知道指令周期由提取、解码、执行和读/写功能组成。在每个指令周期之后，处理器将检查要处理的中断。如果系统中没有中断，它将进入指令寄存器给出的下一个指令周期。如果存在中断，那么它将触发中断处理程序。处理器将停止正在处理的当前指令，将其配置保存在寄存器中，并从中断向量表给出的位置加载中断的程序计数器。

处理器处理完中断后，中断处理器将从保存的寄存器中加载指令及其配置。这个过程将从它剩下的地方开始处理。这样保存了旧的指令处理配置，加载新的中断配置也叫 ***上下文切换*** 。有不同类型的中断处理程序。

1.  ***一级中断处理程序*** (FLIH)是硬中断处理程序或快速中断处理程序。这些中断处理程序在进程执行时抖动更大，它们主要是可屏蔽的中断。
2.  ***二级中断处理程序*** (SLIH)是软中断处理程序和慢中断处理程序。这些中断处理程序抖动较小。

中断处理程序也被称为中断服务程序(ISR)。印度空间研究中心的主要特点是

*   中断可以随时发生，并且是异步的，ISR 可以调用异步中断。
*   中断服务机制可以从多个来源调用 ISR。
*   ISR 可以处理可屏蔽和不可屏蔽的中断。程序中的指令可以禁用或启用中断处理程序调用。
*   ISR 在执行开始时会禁用其他设备的中断服务。ISR 执行完成后，它将重新初始化中断服务。
*   ISR 中允许嵌套中断转移到其他 ISR。

### 中断等待

当一个中断发生时，通过执行中断服务程序的中断服务可能不会通过上下文切换立即启动。中断发生和中断服务报告开始执行之间的时间间隔称为中断延迟。

*   **ts switch =**上下文切换所用的时间
*   **σTexec =**执行 ISR 的时间间隔之和
*   **中断延迟**= t switch+σTexec

### 中央处理器如何响应中断

理解操作系统如何工作的一个关键点是理解当中断发生时中央处理器做什么。中央处理器硬件对每个中断都做同样的事情，允许操作系统从当前运行的用户进程中拿走控制权。从操作系统内核执行代码的运行进程的切换被称为 ***上下文切换*** 。

CPU 依靠包含在几个寄存器中的数据来正确处理中断。一个寄存器保存指向当前正在运行的进程的进程控制块的指针，每次进程加载到内存中时，该寄存器都会被置位。另一个寄存器保存指向一个表的指针，该表包含指向操作系统内核中用于中断处理程序和系统调用的指令的指针。该寄存器中的值和表的内容是在引导时初始化操作系统时设置的。中央处理器响应中断执行以下操作:

1.  使用指向当前过程控制块的指针，保存状态和所有寄存器值，以供以后重新启动过程时使用。
2.  中央处理器模式位切换到监控
3.  使用指向中断处理程序表的指针和中断向量，确定要执行的内核代码的位置。中断向量是硬件中断的 IRQ，也是软件中断的中断汇编语言指令的参数。
4.  处理被切换到内核的适当部分。

![What is Interrupt in OS](../Images/4928162b4b33915c6a8b20935bfc02ca.png)

中央处理器使用一个表和中断向量来找到操作系统响应中断要执行的代码。下图显示了一个软件中断。

![What is Interrupt in OS](../Images/20940e65a04f1626009eb186324383ff.png)

当计算机运行时，当接收到硬件和软件中断时，处理在用户进程和操作系统之间切换。

### 触发方法

每个中断信号输入设计为由逻辑信号电平或特定信号边沿(电平转换)触发。对电平敏感的输入持续请求处理器服务，只要特定(高或低)逻辑电平应用于输入。边沿敏感输入对信号边沿做出反应:特定(上升或下降)边沿将导致服务请求被锁存。当中断处理程序执行时，处理器复位锁存器。

![What is Interrupt in OS](../Images/f62724500ea0f8c54ee1eae8e8aef7dd.png)

### 1.级别触发

通过将中断信号保持在其特定(高或低)有效逻辑电平，请求电平触发中断。设备通过将信号驱动到并保持在活动电平来调用电平触发中断。当处理器发出命令时，通常在设备维修后，它会否定信号。

处理器在每个指令周期对中断输入信号进行采样。如果采样发生时信号有效，处理器将识别中断请求。

电平触发输入允许多个设备通过有线或连接共享一个公共中断信号。处理器轮询以确定哪些设备正在请求服务。在维修设备后，处理器可能会再次轮询，如果需要，在退出 ISR 之前维修其他设备。

### 2.边沿触发

边沿触发中断是由中断线路上的电平转换(下降沿(从高到低)或上升沿(从低到高))发出的中断信号。希望发出中断信号的设备将一个脉冲驱动到线路上，并将其释放到非活动状态。如果脉冲太短，轮询输入/输出无法检测到，则可能需要特殊的硬件来检测。

* * *